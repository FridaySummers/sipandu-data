<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIPANDU DATA - Laporan & Analisis</title>
  <link rel="stylesheet" href="styles.css"><link rel="stylesheet" href="dashboard.css"><link rel="stylesheet" href="mobile.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page force-light">
  <nav class="top-nav">
    <div class="nav-left"><button class="sidebar-toggle" id="sidebar-toggle"><i class="fas fa-bars"></i></button><div class="nav-logo"><i class="fas fa-chart-line"></i><span>SIPANDU DATA</span></div></div>
    <div class="nav-center"><div class="search-box"><i class="fas fa-search"></i><input type="text" placeholder="Cari laporan..."></div></div>
    <div class="nav-right">
      <div class="nav-item notifications" id="notifications"><i class="fas fa-bell"></i><span class="badge" id="notification-count">2</span><div class="dropdown notification-dropdown" id="notification-dropdown"><div class="dropdown-header"><h3>Notifikasi</h3><button class="mark-all-read">Tandai Semua Dibaca</button></div><div class="notification-list" id="notification-list"></div></div></div>
      <div class="nav-item user-menu" id="user-menu"><div class="user-avatar"><i class="fas fa-user"></i></div><span class="user-name" id="user-name">User</span><i class="fas fa-chevron-down"></i><div class="dropdown user-dropdown" id="user-dropdown"><a href="dashboard.html" class="dropdown-item"><i class="fas fa-home"></i> Dashboard</a><a href="#" class="dropdown-item" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Keluar</a></div></div>
    </div>
  </nav>
  <aside class="sidebar" id="sidebar"><div class="sidebar-header"><div class="user-info"><div class="user-avatar"><i class="fas fa-user-tie"></i></div><div class="user-details"><h4 id="sidebar-user-name">User</h4><p id="sidebar-user-role">Role</p></div></div></div><nav class="sidebar-nav"><ul class="nav-menu"><li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li><li class="nav-item"><a href="datamanagement.html" class="nav-link"><i class="fas fa-database"></i><span>Data Management</span></a></li><li class="nav-item active"><a href="reports.html" class="nav-link"><i class="fas fa-chart-bar"></i><span>Laporan & Analisis</span></a></li><li class="nav-item"><a href="forum.html" class="nav-link"><i class="fas fa-comments"></i><span>Forum Diskusi</span></a></li><li class="nav-item"><a href="calendar.html" class="nav-link"><i class="fas fa-calendar"></i><span>Agenda & Kalender</span></a></li><li class="nav-item"><a href="dinas-status.html" class="nav-link"><i class="fas fa-building"></i><span>Status Dinas</span></a></li><li class="nav-item"><a href="settings.html" class="nav-link"><i class="fas fa-cog"></i><span>Pengaturan</span></a></li></ul></nav></aside>
  <main class="main-content">
    <div class="page-header"><h1>Laporan & Analisis</h1><p>Visualisasi dan analisis data perencanaan</p></div>
    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-icon"><i class="fas fa-file-alt"></i></div><div class="kpi-content"><div class="kpi-value" id="rep-kpi-total">0</div><div class="kpi-label">Total Laporan</div></div><div class="kpi-delta" id="rep-kpi-total-delta">+0</div></div>
      <div class="kpi-card"><div class="kpi-icon success"><i class="fas fa-chart-line"></i></div><div class="kpi-content"><div class="kpi-value" id="rep-kpi-avg">0%</div><div class="kpi-label">Avg. Completion</div></div><div class="kpi-delta" id="rep-kpi-avg-delta">+0</div></div>
      <div class="kpi-card"><div class="kpi-icon info"><i class="fas fa-database"></i></div><div class="kpi-content"><div class="kpi-value" id="rep-kpi-points">0</div><div class="kpi-label">Data Points</div></div><div class="kpi-delta" id="rep-kpi-points-delta">+0</div></div>
      <div class="kpi-card"><div class="kpi-icon warning"><i class="fas fa-list"></i></div><div class="kpi-content"><div class="kpi-value" id="rep-kpi-active">0</div><div class="kpi-label">Active Reports</div></div><div class="kpi-delta" id="rep-kpi-active-delta">+0</div></div>
    </div>
    <div class="reports-filters"><select id="rep-opd-filter"><option value="">Semua OPD</option></select><select id="rep-period-filter"><option value="2025">2025</option><option value="2024">2024</option></select><button class="btn btn-secondary" id="rep-export-pdf"><i class="fas fa-file-pdf"></i>Export PDF</button><button class="btn btn-secondary" id="rep-export-xlsx"><i class="fas fa-file-excel"></i>Export XLSX</button><button class="btn btn-secondary" id="rep-export-csv"><i class="fas fa-file-csv"></i>Export CSV</button></div>
    <div class="charts-grid"><div class="chart-card"><div class="card-header"><h3>Tren Penyelesaian Data</h3></div><div class="card-body"><canvas id="rep-monthly-chart"></canvas></div></div><div class="chart-card"><div class="card-header"><h3>Status Data per OPD</h3></div><div class="card-body"><canvas id="rep-status-chart"></canvas></div></div><div class="chart-card"><div class="card-header"><h3>Kategori Data</h3></div><div class="card-body"><canvas id="rep-category-chart"></canvas></div></div></div>

    <div class="bottom-grid" style="margin-top: var(--space-6);">
      <div class="chart-card">
        <div class="card-header"><h3>Distribusi Data per Kategori</h3></div>
        <div class="card-body"><canvas id="rep-distribution-chart"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="card-header"><h3>Performance Dinas</h3></div>
        <div class="card-body" id="perf-list"></div>
      </div>
    </div>

    <div class="card" style="margin-top: var(--space-6);">
      <div class="card-header"><h3>Laporan Tersedia</h3></div>
      <div class="card-body" id="report-list"></div>
    </div>
  </main>
  <script src="app.js"></script><script src="utils.js"></script><script src="charts.js"></script><script>
    document.addEventListener('DOMContentLoaded', ()=>{ UIComponents.renderNotifications(); const user=authHandler.getCurrentUser(); document.getElementById('user-name').textContent=user.name; document.getElementById('sidebar-user-name').textContent=user.name; document.getElementById('sidebar-user-role').textContent=user.position; const opdFilter=document.getElementById('rep-opd-filter'); const periodFilter=document.getElementById('rep-period-filter'); dinasData.forEach(d=>{const o=document.createElement('option'); o.value=d.name; o.textContent=d.name; opdFilter.appendChild(o);}); const months=['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des']; const monthlyChart=new Chart(document.getElementById('rep-monthly-chart'),{type:'line',data:{labels:months,datasets:[{label:'Progress',data:months.map((_,i)=>50+Math.round(Math.sin(i)*20)),borderColor:'#2563eb',backgroundColor:'rgba(37,99,235,0.2)',tension:0.3}]},options:{responsive:true,maintainAspectRatio:false}}); const statusChart=new Chart(document.getElementById('rep-status-chart'),{type:'bar',data:{labels:dinasData.map(d=>d.name),datasets:[{label:'Complete',data:dinasData.map(d=> d.status==='Complete'?1:0),backgroundColor:'#22c55e'},{label:'Progress',data:dinasData.map(d=> d.status==='In Progress'?1:0),backgroundColor:'#f59e0b'},{label:'Pending',data:dinasData.map(d=> d.status==='Pending'?1:0),backgroundColor:'#ef4444'}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,stacked:true},x:{stacked:true}}}}); const categoryChart=new Chart(document.getElementById('rep-category-chart'),{type:'doughnut',data:{labels:['Keuangan','Produksi','SDM','Konsumsi'],datasets:[{data:[30,25,20,25],backgroundColor:['#3b82f6','#10b981','#f59e0b','#64748b']}]},options:{responsive:true,maintainAspectRatio:false}}); const updateCharts=()=>{ const filter=opdFilter.value; const scale=(periodFilter.value==='2024')?0.9:1; monthlyChart.data.datasets[0].data=months.map((_,i)=> Math.round((50+Math.sin(i)*20)*scale)); monthlyChart.update(); const names=dinasData.map(d=>d.name).filter(n=> filter? n===filter : true); statusChart.data.labels=names; const dataSet=(status)=> names.map(n=>{ const d=dinasData.find(x=> x.name===n); return d && d.status===status ? 1 : 0; }); statusChart.data.datasets[0].data=dataSet('Complete'); statusChart.data.datasets[1].data=dataSet('In Progress'); statusChart.data.datasets[2].data=dataSet('Pending'); statusChart.update(); }; opdFilter.onchange=updateCharts; periodFilter.onchange=updateCharts; document.getElementById('rep-export-pdf').onclick=()=>Utils.showToast('Export PDF dibuat','success'); document.getElementById('rep-export-xlsx').onclick=()=>Utils.showToast('Export XLSX dibuat','success'); document.getElementById('rep-export-csv').onclick=()=>{ const rows=[['OPD','Status'], ...dinasData.map(d=>[d.name,d.status])]; const csv=rows.map(r=> r.join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='laporan.csv'; a.click(); URL.revokeObjectURL(a.href); Utils.showToast('Export CSV diunduh','success'); }; document.getElementById('logout-btn').onclick=(e)=>{e.preventDefault(); authHandler.logout();}; });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const months=['Jan','Feb','Mar','Apr','Mei','Jun'];

      const mCanvas=document.getElementById('rep-monthly-chart');
      const prevM=window.Chart && Chart.getChart ? Chart.getChart(mCanvas) : null;
      if (prevM) prevM.destroy();
      new Chart(mCanvas,{type:'bar',data:{labels:months,datasets:[
        {label:'Complete',data:[60,78,85,92,88,96],backgroundColor:'#22c55e'},
        {label:'In Progress',data:[25,18,12,10,9,7],backgroundColor:'#f59e0b'},
        {label:'Pending',data:[10,6,3,2,3,1],backgroundColor:'#ef4444'}
      ]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true,max:100}},plugins:{legend:{position:'bottom'}}}});

      const sCanvas=document.getElementById('rep-status-chart');
      const prevS=window.Chart && Chart.getChart ? Chart.getChart(sCanvas) : null;
      if (prevS) prevS.destroy();
      const complete=dinasData.filter(d=> d.status==='Complete').length;
      const progress=dinasData.filter(d=> d.status==='Progress' || d.status==='In Review').length;
      const pending=dinasData.filter(d=> d.status==='Pending').length;
      new Chart(sCanvas,{type:'doughnut',data:{labels:['Complete','Progress','Pending'],datasets:[{data:[complete,progress,pending],backgroundColor:['#22c55e','#f59e0b','#ef4444'],hoverOffset:8}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},cutout:'60%'}});
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('rep-kpi-total').textContent='156';
      document.getElementById('rep-kpi-avg').textContent='87%';
      document.getElementById('rep-kpi-points').textContent='12.5K';
      document.getElementById('rep-kpi-active').textContent='24';

      const distChart=new Chart(document.getElementById('rep-distribution-chart'),{type:'pie',data:{labels:['Kesehatan','Ekonomi','Pendidikan','Pertanian','Infrastruktur','Sosial'],datasets:[{data:[23,15,18,14,17,13],backgroundColor:['#3b82f6','#10b981','#f59e0b','#22c55e','#64748b','#06b6d4']}]},options:{responsive:true,maintainAspectRatio:false}});

      const perfList=document.getElementById('perf-list');
      const perfData=[{name:'Perdagangan',val:95},{name:'Kesehatan',val:89},{name:'Pendidikan',val:82},{name:'Pertanian',val:76},{name:'Perhubungan',val:85},{name:'Sosial',val:79}];
      perfList.innerHTML=perfData.map((p,i)=>`<div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;"><div style="width:24px;color:var(--gray-500);">${i+1}.</div><div style="flex:1"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span>${p.name}</span><span style="color:#16a34a;font-weight:600;">${p.val}%</span></div><div style="height:8px;background:#e5e7eb;border-radius:9999px;overflow:hidden;"><div style="width:${p.val}%;height:8px;background:#22c55e;"></div></div></div></div>`).join('');

      const reportList=document.getElementById('report-list');
      const reports=[
        {title:'Laporan Komprehensif RKPD 2025 - Q1',tag:'final',cat:'Quarterly',date:'2025-03-31',size:'2.4 MB'},
        {title:'Analisis Data Ekonomi Regional',tag:'final',cat:'Ekonomi',date:'2025-03-15',size:'1.8 MB'},
        {title:'Evaluasi Program Kesehatan',tag:'final',cat:'Kesehatan',date:'2025-03-10',size:'3.1 MB'},
        {title:'Progress Report Infrastruktur',tag:'draft',cat:'Infrastruktur',date:'2025-03-05',size:'2.7 MB'}
      ];
      reportList.innerHTML=reports.map(r=>`<div class="file-item" style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid var(--gray-200);"><div><div class="thread-title">${r.title}</div><div class="thread-meta">${r.cat} • ${DateUtils.formatDate(r.date,{day:'2-digit',month:'short',year:'numeric'})} • ${r.size} • <span style="color:${r.tag==='final'?'#16a34a':'#f59e0b'};font-weight:600;">${r.tag}</span></div></div><button class="btn btn-outline btn-sm"><i class="fas fa-download"></i> Download</button></div>`).join('');
    });
  </script>
</body>
</html>
