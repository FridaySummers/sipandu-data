<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIPANDU DATA - Forum Diskusi</title>
  <link rel="stylesheet" href="styles.css"><link rel="stylesheet" href="dashboard.css"><link rel="stylesheet" href="mobile.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page force-light">
  <nav class="top-nav">
    <div class="nav-left"><button class="sidebar-toggle" id="sidebar-toggle"><i class="fas fa-bars"></i></button><div class="nav-logo"><i class="fas fa-chart-line"></i><span>SIPANDU DATA</span></div></div>
    <div class="nav-center"><div class="search-box"><i class="fas fa-search"></i><input type="text" placeholder="Cari diskusi..."></div></div>
    <div class="nav-right"><div class="nav-item notifications" id="notifications"><i class="fas fa-bell"></i><span class="badge" id="notification-count">2</span><div class="dropdown notification-dropdown" id="notification-dropdown"><div class="dropdown-header"><h3>Notifikasi</h3><button class="mark-all-read">Tandai Semua Dibaca</button></div><div class="notification-list" id="notification-list"></div></div></div><div class="nav-item user-menu" id="user-menu"><div class="user-avatar"><i class="fas fa-user"></i></div><span class="user-name" id="user-name">User</span><i class="fas fa-chevron-down"></i><div class="dropdown user-dropdown" id="user-dropdown"><a href="dashboard.html" class="dropdown-item"><i class="fas fa-home"></i> Dashboard</a><a href="#" class="dropdown-item" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Keluar</a></div></div></div>
  </nav>
  <aside class="sidebar" id="sidebar"><div class="sidebar-header"><div class="user-info"><div class="user-avatar"><i class="fas fa-user-tie"></i></div><div class="user-details"><h4 id="sidebar-user-name">User</h4><p id="sidebar-user-role">Role</p></div></div></div><nav class="sidebar-nav"><ul class="nav-menu"><li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li><li class="nav-item"><a href="datamanagement.html" class="nav-link"><i class="fas fa-database"></i><span>Data Management</span></a></li><li class="nav-item"><a href="reports.html" class="nav-link"><i class="fas fa-chart-bar"></i><span>Laporan & Analisis</span></a></li><li class="nav-item active"><a href="forum.html" class="nav-link"><i class="fas fa-comments"></i><span>Forum Diskusi</span></a></li><li class="nav-item"><a href="calendar.html" class="nav-link"><i class="fas fa-calendar"></i><span>Agenda & Kalender</span></a></li><li class="nav-item"><a href="dinas-status.html" class="nav-link"><i class="fas fa-building"></i><span>Status Dinas</span></a></li><li class="nav-item"><a href="settings.html" class="nav-link"><i class="fas fa-cog"></i><span>Pengaturan</span></a></li></ul></nav></aside>
  <main class="main-content">
    <div class="page-header"><h1>Forum Diskusi</h1><p>Koordinasi dan diskusi lintas OPD</p></div>
    <div class="forum-grid"><div class="forum-threads"><div class="threads-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;"><h3>Topik Terbaru</h3><div style="display:flex;align-items:center;gap:12px;"><div class="search-box"><i class="fas fa-search"></i><input id="forum-search" type="text" placeholder="Cari diskusi, topik, atau pengguna..."></div><select id="forum-category" style="border:1px solid var(--gray-300);border-radius:9999px;padding:8px 12px;"><option value="">Semua Kategori</option><option value="Metodologi">Metodologi</option><option value="Best Practice">Best Practice</option><option value="Pengumuman">Pengumuman</option><option value="Problem Solving">Problem Solving</option></select><button class="btn btn-primary" id="forum-new"><i class="fas fa-plus"></i> Buat Diskusi Baru</button></div></div><div class="thread-list" id="thread-list"></div></div><div class="forum-detail"><div class="card"><div class="card-header"><h3>Detail Diskusi</h3></div><div class="card-body" id="thread-detail">Pilih topik untuk melihat detail</div><div class="card-footer" id="thread-composer" style="display:none"><div class="form-row"><label>Balasan</label><textarea id="reply-input" rows="3" placeholder="Tulis balasan..."></textarea></div><div style="display:flex;justify-content:flex-end;gap:12px"><button class="btn btn-secondary" id="reply-cancel">Batal</button><button class="btn btn-primary" id="reply-send">Kirim</button></div></div></div></div></div>
  </main>
  <div class="modal-overlay" id="forum-modal"><div class="modal"><div class="modal-header"><h3>Buat Topik Baru</h3><button class="btn btn-outline btn-sm" id="forum-close">✕</button></div><div class="modal-body"><div class="form-row"><label>Judul</label><input id="forum-title" type="text" placeholder="Judul topik"></div><div class="form-row"><label>OPD</label><select id="forum-opd"></select></div><div class="form-row"><label>Konten</label><textarea id="forum-content" rows="4" placeholder="Isi diskusi"></textarea></div></div><div class="modal-footer"><button class="btn btn-secondary" id="forum-cancel">Batal</button><button class="btn btn-primary" id="forum-save">Simpan</button></div></div></div>
  <script src="app.js"></script><script src="utils.js"></script><script>
    document.addEventListener('DOMContentLoaded', ()=>{ UIComponents.renderNotifications(); const user=authHandler.getCurrentUser(); document.getElementById('user-name').textContent=user.name; document.getElementById('sidebar-user-name').textContent=user.name; document.getElementById('sidebar-user-role').textContent=user.position; const threads=[{id:1,title:'Standarisasi Format Data',author:'Bappeda',replies:12,time:'2 jam lalu',messages:['Setuju standar JSON','Perlu mapping OPD']},{id:2,title:'Deadline Triwulan III',author:'Bapenda',replies:5,time:'5 jam lalu',messages:['Mohon update progres','Siap diunggah esok']},{id:3,title:'Integrasi Portal Sektoral',author:'Perdagangan',replies:3,time:'1 hari lalu',messages:['Perlu API token','Dokumentasi menyusul']}]; const list=document.getElementById('thread-list'); const detail=document.getElementById('thread-detail'); const composer=document.getElementById('thread-composer'); const replyInput=document.getElementById('reply-input'); const replySend=document.getElementById('reply-send'); const replyCancel=document.getElementById('reply-cancel'); let activeId=null; const render=()=>{ list.innerHTML=threads.map(t=>`<div class="thread-item" data-id="${t.id}"><div><div class="thread-title">${t.title}</div><div class="thread-meta">${t.author} • ${t.replies} balasan • ${t.time}</div></div><button class="btn btn-outline btn-sm">Buka</button></div>`).join(''); list.querySelectorAll('.thread-item').forEach(item=>{ item.addEventListener('click', ()=>{ const t=threads.find(x=> x.id===parseInt(item.dataset.id)); if(t){ activeId=t.id; composer.style.display='block'; const msgs=t.messages.map(m=>`<div class='file-item'><div>${m}</div></div>`).join(''); detail.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"><h3>${t.title}</h3><span class="thread-meta">${t.author} • ${t.time}</span></div>${msgs}`; } }); }); }; render(); const modal=document.getElementById('forum-modal'); const openBtn=document.getElementById('forum-new'); const closeBtn=document.getElementById('forum-close'); const cancelBtn=document.getElementById('forum-cancel'); const saveBtn=document.getElementById('forum-save'); const titleInput=document.getElementById('forum-title'); const opdSelect=document.getElementById('forum-opd'); dinasData.forEach(d=>{const o=document.createElement('option'); o.value=d.name; o.textContent=d.name; opdSelect.appendChild(o);}); const toggle=(show)=>{ modal.style.display=show?'flex':'none'; }; openBtn.onclick=()=>{ toggle(true); }; closeBtn.onclick=()=> toggle(false); cancelBtn.onclick=()=> toggle(false); saveBtn.onclick=()=>{ if(!titleInput.value || !opdSelect.value){ Utils.showToast('Lengkapi topik','error'); return; } threads.unshift({ id:Date.now(), title:titleInput.value, author:opdSelect.value, replies:0, time:'baru', messages:[] }); render(); toggle(false); Utils.showToast('Topik dibuat','success'); }; replyCancel.onclick=()=>{ composer.style.display='none'; }; replySend.onclick=()=>{ if(!replyInput.value || !activeId) return; const t=threads.find(x=> x.id===activeId); t.messages.push(replyInput.value); t.replies = t.messages.length; replyInput.value=''; render(); Utils.showToast('Balasan terkirim','success'); }; document.getElementById('logout-btn').onclick=(e)=>{e.preventDefault(); authHandler.logout();}; });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const search=document.getElementById('forum-search');
      const category=document.getElementById('forum-category');
      const filterList=()=>{
        const query=(search?.value||'').toLowerCase();
        const cat=category?.value||'';
        document.querySelectorAll('#thread-list .thread-item').forEach(item=>{
          const text=item.textContent.toLowerCase();
          const hasQuery=query? text.includes(query) : true;
          const meta=item.querySelector('.thread-meta')?.textContent||'';
          const hasCat=cat? meta.includes(cat) : true;
          item.style.display = (hasQuery && hasCat) ? 'flex' : 'none';
        });
      };
      if (search) search.addEventListener('input', Utils.debounce(filterList, 200));
      if (category) category.addEventListener('change', filterList);
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const list=document.getElementById('thread-list');
      const detail=document.getElementById('thread-detail');
      const composer=document.getElementById('thread-composer');
      const threads=[
        {id:1,title:'Diskusi Metodologi Pengumpulan Data Ekonomi Regional',subtitle:'Bagaimana pendekatan terbaik untuk mengumpulkan data inflasi di daerah?',author:'Ahmad Yani',opd:'Dinas Perdagangan',category:'Metodologi',date:'2025-01-10',lastReply:'2 jam lalu',likes:24,replies:12,views:158,messages:['Gunakan definisi variabel yang konsisten','Pertimbangkan seasonal adjustment']},
        {id:2,title:'Best Practice Pelaporan Data Pendidikan',subtitle:'Mari berbagi pengalaman tentang cara efektif merekap dan validasi',author:'Budi Santoso',opd:'Dinas Pendidikan',category:'Best Practice',date:'2025-01-08',lastReply:'1 jam lalu',likes:31,replies:15,views:234,messages:['Template pelaporan terbaru dilampirkan','Contoh validasi kolom']},
        {id:3,title:'Update Regulasi Pelaporan RKPD 2025',subtitle:'Informasi terbaru mengenai perubahan format pelaporan',author:'Admin Bappeda',opd:'Bappeda',category:'Pengumuman',date:'2025-01-15',lastReply:'1 jam lalu',likes:42,replies:6,views:342,messages:['Regulasi terbaru No. 5/2025','Sosialisasi pekan depan']},
        {id:4,title:'Integrasi Data Kesehatan dengan Sistem Nasional',subtitle:'Perlu bantuan untuk integrasi data e-health nasional',author:'Sri Aminah',opd:'Dinas Kesehatan',category:'Teknis',date:'2025-01-12',lastReply:'5 jam lalu',likes:18,replies:8,views:89,messages:['Endpoint API tersedia','Mapping kolom selesai']},
        {id:5,title:'Kendala Validasi Data Pertanian',subtitle:'Apa kendala masalah dengan validasi data produksi padi?',author:'Rina Wati',opd:'Dinas Pertanian',category:'Problem Solving',date:'2025-01-14',lastReply:'3 jam lalu',likes:15,replies:9,views:112,messages:['Outlier pada produksi padi','Butuh panduan pembersihan data']},
      ];
      const render=()=>{
        list.innerHTML=threads.map(t=>`<div class="thread-item" data-id="${t.id}"><div class="thread-item-inner"><div class="thread-avatar">${t.author.charAt(0)}</div><div><div class="thread-title">${t.title}</div><div class="thread-subtitle">${t.subtitle}</div><div class="thread-tags"><span class="tag">${t.opd}</span><span class="tag">${t.category}</span><span class="tag">${DateUtils.formatDate(t.date,{day:'2-digit',month:'short',year:'numeric'})}</span></div><div class="thread-meta">Balasan terakhir: ${t.lastReply}</div></div><div class="thread-stats"><span><i class="fas fa-thumbs-up"></i>${t.likes}</span><span><i class="fas fa-comment"></i>${t.replies}</span><span><i class="fas fa-eye"></i>${t.views} views</span><button class="btn btn-outline btn-sm">Buka</button></div></div></div>`).join('');
        list.querySelectorAll('.thread-item').forEach(item=>{
          item.addEventListener('click', ()=>{
            const t=threads.find(x=> x.id===parseInt(item.dataset.id));
            if(!t) return;
            composer.style.display='block';
            const msgs=t.messages.map(m=>`<div class='file-item'><div>${m}</div></div>`).join('');
            detail.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"><h3>${t.title}</h3><span class="thread-meta">${t.author} • ${t.opd} • ${t.category}</span></div>${msgs}`;
          });
        });
      };
      setTimeout(render, 0);
    });
  </script>
</body>
</html>
